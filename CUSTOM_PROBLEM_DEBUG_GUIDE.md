# 自定义题目功能调试指南

## 🎯 功能概述

本指南介绍如何测试和验证自定义题目功能，包括题目提交、审核和发布的完整流程。

## 📋 功能清单

### ✅ 已实现功能

1. **数据模型扩展**
   - 扩展了 Problem 接口，添加自定义题目相关字段
   - 创建了 CustomProblemSubmission 接口
   - 添加了审核相关的接口定义

2. **后端服务**
   - CustomProblemService 服务类
   - 题目提交、审核、管理功能
   - 本地文件存储管理

3. **前端界面**
   - 题目列表页面添加"提交自定义题目"按钮
   - 自定义题目提交表单页面
   - 管理员审核界面
   - 相关样式文件

4. **集成配置**
   - extension.ts 中集成 CustomProblemService
   - PromptPilotPanel 中添加消息处理
   - main.js 中添加前端交互逻辑

## 🔧 测试准备

### 1. 编译和打包插件

```bash
# 编译 TypeScript
npm run compile

# 打包插件
vsce package --no-dependencies
```

### 2. 安装和启动插件

1. 在 VSCode 中按 F5 启动调试模式
2. 或安装生成的 .vsix 文件
3. 打开命令面板 (Ctrl+Shift+P)
4. 运行 "Prompt Pilot: 打开主面板"

## 🧪 功能测试步骤

### 测试1: 基本界面显示

1. **验证主界面**
   - ✅ 主界面正常加载
   - ✅ 精选题目卡片可点击
   - ✅ 点击后显示题目列表

2. **验证题目列表页面**
   - ✅ 题目列表正常显示
   - ✅ 页面header包含"提交自定义题目"按钮
   - ✅ 按钮样式正确（蓝色主要按钮）

### 测试2: 自定义题目提交界面

1. **打开提交界面**
   ```
   题目列表页面 → 点击"📝 提交自定义题目"按钮
   ```
   - ✅ 成功跳转到提交页面
   - ✅ 页面标题显示"📝 提交自定义题目"
   - ✅ 返回按钮正常工作

2. **验证表单界面**
   - ✅ 基本信息区域：标题、难度、分类、描述
   - ✅ 代码模板区域：初始代码输入框
   - ✅ 测试用例区域：输入、输出、说明
   - ✅ 提示信息区域：可选的解题提示
   - ✅ 操作按钮：预览、提交审核

3. **验证测试用例功能**
   - ✅ 默认显示一个测试用例
   - ✅ "➕ 添加测试用例"按钮工作正常
   - ✅ 删除按钮在多个测试用例时显示
   - ✅ 保留至少一个测试用例的逻辑

### 测试3: 表单验证

1. **必填字段验证**
   - ✅ 标题为空时显示错误
   - ✅ 难度未选择时显示错误
   - ✅ 分类为空时显示错误
   - ✅ 描述为空时显示错误
   - ✅ 代码模板为空时显示错误
   - ✅ 测试用例输入/输出为空时显示错误

2. **字段长度限制**
   - ✅ 标题不超过100个字符
   - ✅ 分类不超过50个字符

### 测试4: 题目提交流程

1. **填写完整表单**
   ```
   标题: 测试题目
   难度: Easy
   分类: 测试
   描述: 这是一个测试题目的描述...
   代码模板: function solve() { return null; }
   测试用例: 输入/输出/说明
   ```

2. **提交验证**
   - ✅ 表单数据正确收集
   - ✅ 发送到后端处理
   - ✅ 显示提交成功消息
   - ✅ 清空表单或跳转选项

### 测试5: 管理员审核界面

1. **打开管理界面**
   ```
   题目列表页面 → 点击"⚙️ 管理"按钮（需要管理员权限）
   ```
   - ✅ 管理界面正常显示
   - ✅ 统计信息正确显示
   - ✅ 选项卡切换正常

2. **待审核列表**
   - ✅ 显示提交的题目列表
   - ✅ 题目信息完整显示
   - ✅ 审核按钮（查看详情、通过、拒绝）

### 测试6: 审核流程

1. **审核操作**
   - ✅ 点击"✅ 通过"按钮
   - ✅ 题目移动到已通过状态
   - ✅ 题目添加到主题目列表
   - ✅ 统计信息更新

2. **拒绝操作**
   - ✅ 点击"❌ 拒绝"按钮
   - ✅ 题目移动到已拒绝状态
   - ✅ 统计信息更新

## 🐛 常见问题排查

### 问题1: 页面不显示

**症状**: 点击按钮后页面没有反应

**排查步骤**:
1. 检查浏览器控制台错误
2. 验证元素ID是否正确
3. 检查事件监听器是否注册

**解决方案**:
```javascript
// 检查元素是否存在
console.log('元素存在:', !!document.getElementById('elementId'));

// 检查事件监听器
elements.submitCustomProblemBtn?.addEventListener('click', showCustomProblemSubmission);
```

### 问题2: 表单提交失败

**症状**: 点击提交后没有响应或报错

**排查步骤**:
1. 检查表单数据收集逻辑
2. 验证后端消息处理
3. 查看 VSCode 输出面板

**解决方案**:
```typescript
// 在 handleSubmitCustomProblem 方法中添加日志
console.log('收到提交请求:', submission);
```

### 问题3: 样式显示异常

**症状**: 界面布局错乱或样式不正确

**排查步骤**:
1. 检查 CSS 文件是否正确加载
2. 验证类名是否匹配
3. 检查响应式样式

**解决方案**:
```css
/* 确保基本样式生效 */
.custom-submission-screen {
    display: block !important;
}
```

## 📊 测试报告模板

### 基本信息
- 测试日期: ____
- 测试版本: ____
- 测试环境: VSCode ____

### 功能测试结果

| 功能模块 | 测试项目 | 结果 | 备注 |
|---------|---------|------|------|
| 界面显示 | 主界面加载 | ✅/❌ | |
| 界面显示 | 题目列表显示 | ✅/❌ | |
| 题目提交 | 表单界面 | ✅/❌ | |
| 题目提交 | 字段验证 | ✅/❌ | |
| 题目提交 | 提交流程 | ✅/❌ | |
| 管理审核 | 管理界面 | ✅/❌ | |
| 管理审核 | 审核流程 | ✅/❌ | |

### 发现的问题

1. **问题描述**: ____
   - **重现步骤**: ____
   - **预期结果**: ____
   - **实际结果**: ____
   - **严重程度**: 高/中/低

## 🚀 后续开发计划

### 待实现功能

1. **题目预览功能**
   - 实现 previewCustomProblem 函数
   - 添加预览弹窗界面

2. **测试用例验证**
   - 添加测试用例格式验证
   - 实现简单的代码执行测试

3. **用户权限管理**
   - 实现管理员权限检查
   - 添加用户身份验证

4. **审核工作流增强**
   - 添加审核评论功能
   - 实现修改建议功能

5. **通知系统**
   - 题目审核结果通知
   - 邮件或系统消息提醒

## 💡 最佳实践

1. **代码质量**
   - 添加单元测试
   - 完善错误处理
   - 优化性能

2. **用户体验**
   - 添加加载状态指示
   - 完善错误提示信息
   - 优化界面响应式设计

3. **数据安全**
   - 输入数据验证
   - 防止XSS攻击
   - 安全的文件存储

---

## 📝 使用说明

1. 将此文件保存为 `CUSTOM_PROBLEM_DEBUG_GUIDE.md`
2. 按照测试步骤逐项验证功能
3. 记录测试结果和发现的问题
4. 根据问题排查部分解决遇到的困难
5. 使用测试报告模板记录完整的测试过程