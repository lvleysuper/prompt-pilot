# Prompt Pilot API 配置功能验证指南

## 🎯 新增功能概述

本次更新为 Prompt Pilot 插件增加了完整的 API 配置和验证功能，支持：

### 核心功能
- ✅ **多提供商支持**：支持 OpenAI 和 Azure OpenAI
- ✅ **智能配置向导**：引导用户完成 API 配置
- ✅ **连接验证**：实时验证 API 连接状态
- ✅ **状态监控**：显示详细的 API 配置信息
- ✅ **错误诊断**：提供详细的错误信息和解决建议

### 界面增强
- ✅ **侧边栏快速操作**：新增 API 相关快速操作按钮
- ✅ **进度提示**：验证过程显示进度条
- ✅ **状态反馈**：实时显示 API 连接状态

## 📋 功能验证清单

### 1. 基础配置验证

#### 1.1 配置页面访问
- [ ] **通过设置页面**：`Ctrl + ,` → 搜索 "prompt-pilot"
- [ ] **通过命令面板**：`Ctrl + Shift + P` → "Prompt Pilot: 配置 API 设置"
- [ ] **通过侧边栏**：点击 "⚙️ 配置 API" 按钮
- [ ] **配置项完整性**：确认所有配置项都可见且有描述

#### 1.2 配置项验证
**OpenAI 配置**：
- [ ] `prompt-pilot.openai.apiKey` - API 密钥输入
- [ ] `prompt-pilot.openai.model` - 模型选择（下拉菜单）
- [ ] `prompt-pilot.openai.baseUrl` - 基础 URL 设置
- [ ] `prompt-pilot.openai.maxTokens` - 最大令牌数（数字输入）
- [ ] `prompt-pilot.openai.temperature` - 温度参数（0-2）

**Azure OpenAI 配置**：
- [ ] `prompt-pilot.azure.apiKey` - Azure API 密钥
- [ ] `prompt-pilot.azure.endpoint` - Azure 端点
- [ ] `prompt-pilot.azure.deploymentName` - 部署名称
- [ ] `prompt-pilot.azure.apiVersion` - API 版本（下拉菜单）

**通用配置**：
- [ ] `prompt-pilot.provider` - 提供商选择（OpenAI/Azure）
- [ ] `prompt-pilot.timeout` - 超时设置
- [ ] `prompt-pilot.retryAttempts` - 重试次数
- [ ] `prompt-pilot.enableDebugLogs` - 调试日志开关

### 2. 配置向导验证

#### 2.1 启动配置向导
- [ ] **命令执行**：`prompt-pilot.configureAPI` 命令可正常执行
- [ ] **提供商选择**：显示 OpenAI 和 Azure OpenAI 选项
- [ ] **选项描述**：每个选项有清晰的描述和图标

#### 2.2 OpenAI 配置流程
- [ ] **API 密钥输入**：
  - [ ] 输入框有明确提示
  - [ ] 支持密码模式（隐藏输入）
  - [ ] 验证以 "sk-" 开头
  - [ ] 空值验证有效
- [ ] **自动保存**：配置自动保存到用户设置
- [ ] **验证测试**：配置完成后自动验证连接

#### 2.3 Azure OpenAI 配置流程
- [ ] **API 密钥输入**：支持密码模式和空值验证
- [ ] **端点输入**：
  - [ ] 验证 "https://" 开头
  - [ ] 格式提示清晰
- [ ] **部署名称**：必填验证有效
- [ ] **配置保存**：所有配置项正确保存
- [ ] **验证测试**：配置完成后自动验证

### 3. API 验证功能

#### 3.1 验证命令执行
- [ ] **命令触发**：`prompt-pilot.validateAPI` 可正常执行
- [ ] **进度显示**：显示验证进度条和状态消息
- [ ] **超时处理**：长时间无响应有超时机制

#### 3.2 成功验证反馈
- [ ] **成功消息**：显示 "✅ API连接验证成功！"
- [ ] **详细信息**：包含提供商、模型、响应时间
- [ ] **状态更新**：LLM 服务切换到真实模式
- [ ] **用户通知**：显示成功通知消息

#### 3.3 失败验证处理
- [ ] **错误消息**：显示具体错误原因
- [ ] **操作选项**：提供 "查看详情" 和 "重新配置" 选项
- [ ] **日志输出**：错误详情记录到输出面板
- [ ] **故障诊断**：根据错误类型提供解决建议

#### 3.4 错误类型处理
**401 错误**：
- [ ] 错误信息：`API密钥无效或已过期`
- [ ] 建议操作：重新输入 API 密钥

**403 错误**：
- [ ] 错误信息：`API访问被拒绝，请检查权限`
- [ ] 建议操作：检查账户权限和配额

**404 错误**：
- [ ] OpenAI：`模型不存在或API端点错误`
- [ ] Azure：`部署不存在或端点错误`

**429 错误**：
- [ ] 错误信息：`API调用频率超限或余额不足`
- [ ] 建议操作：检查账户余额和调用限制

**网络错误**：
- [ ] 错误信息：`网络连接失败，请检查网络设置`
- [ ] 建议操作：检查网络连接和防火墙

### 4. 状态监控功能

#### 4.1 API 状态显示
- [ ] **命令执行**：`prompt-pilot.showAPIStatus` 正常工作
- [ ] **状态概览**：显示当前提供商和配置状态
- [ ] **详细信息**：根据提供商显示相应配置详情
- [ ] **操作按钮**：提供 "打开配置"、"验证连接" 按钮

#### 4.2 状态信息准确性
**OpenAI 状态**：
- [ ] API 密钥状态（已设置/未设置）
- [ ] 当前模型显示
- [ ] 基础 URL 显示
- [ ] 参数配置显示（最大令牌数、温度）

**Azure 状态**：
- [ ] API 密钥状态
- [ ] 端点配置显示
- [ ] 部署名称显示
- [ ] API 版本显示

**通用设置**：
- [ ] 超时时间显示
- [ ] 重试次数显示
- [ ] 调试日志状态

### 5. 集成功能验证

#### 5.1 LLM 服务集成
- [ ] **模式切换**：
  - [ ] 无配置时：自动模拟模式
  - [ ] 有效配置时：自动真实模式
  - [ ] 配置变更时：自动切换模式
- [ ] **配置刷新**：配置更新后服务自动刷新
- [ ] **错误处理**：API 调用失败时的降级机制

#### 5.2 WebView 界面集成
- [ ] **模式标识**：界面明确显示当前模式（模拟/真实）
- [ ] **配置提示**：模拟模式下显示配置指引
- [ ] **快速配置**：点击配置按钮跳转到设置页面

#### 5.3 侧边栏快速操作
- [ ] **配置 API**：`⚙️ 配置 API` 按钮可用
- [ ] **验证 API**：`✅ 验证 API` 按钮可用
- [ ] **API 状态**：`📊 API 状态` 按钮可用
- [ ] **操作响应**：所有按钮点击有正确响应

## 🧪 测试步骤

### 步骤1：初始状态测试
1. **清空配置**：删除所有 `prompt-pilot` 相关配置
2. **重启插件**：按 `F5` 重新调试
3. **验证提示**：应显示模拟模式警告
4. **检查侧边栏**：确认快速操作按钮存在

### 步骤2：OpenAI 配置测试
1. **启动向导**：点击 "⚙️ 配置 API"
2. **选择 OpenAI**：选择 OpenAI 选项
3. **输入密钥**：输入有效的 OpenAI API 密钥
4. **验证连接**：观察自动验证过程
5. **确认切换**：检查是否切换到真实模式

### 步骤3：Azure OpenAI 配置测试
1. **切换提供商**：在设置中改为 Azure
2. **配置信息**：设置端点、密钥、部署名称
3. **验证连接**：手动执行验证命令
4. **检查状态**：使用状态查看命令确认配置

### 步骤4：错误处理测试
1. **无效密钥**：输入错误的 API 密钥
2. **验证失败**：执行验证命令
3. **错误处理**：检查错误消息和建议操作
4. **日志查看**：确认详细日志记录

### 步骤5：功能集成测试
1. **生成代码**：在真实模式下测试代码生成
2. **分析 Prompt**：测试 Prompt 分析功能
3. **模式切换**：清空配置测试模拟模式回退
4. **界面更新**：确认 WebView 界面正确更新

## 🔧 故障排除

### 常见问题和解决方案

#### 问题1：配置向导无法启动
**症状**：点击配置按钮无响应
**解决方案**：
- 检查命令是否正确注册
- 查看调试控制台错误信息
- 重新编译并重启调试

#### 问题2：API 验证一直失败
**症状**：即使配置正确也验证失败
**排查步骤**：
- 检查网络连接
- 验证 API 密钥格式
- 查看详细错误日志
- 测试 API 端点可达性

#### 问题3：配置不生效
**症状**：配置保存后仍显示模拟模式
**解决方案**：
- 检查配置项名称是否正确
- 确认配置保存位置（用户/工作区）
- 手动刷新配置状态

## 📊 性能指标

### 验证性能基准
- **OpenAI 验证**：< 3秒
- **Azure 验证**：< 5秒
- **配置加载**：< 1秒
- **状态查询**：< 500ms

### 资源使用
- **内存占用**：增加 < 10MB
- **网络请求**：仅验证时发起
- **存储空间**：配置文件 < 1KB

---

**📝 备注**：请按照此验证清单逐项测试，确保所有功能正常工作。如发现问题，请记录具体步骤和错误信息以便排查。