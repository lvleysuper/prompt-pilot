<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>æµ‹è¯•å¤åˆ¶å’Œä½¿ç”¨åŠŸèƒ½</title>
	<style>
		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			max-width: 800px;
			margin: 0 auto;
			padding: 20px;
			line-height: 1.6;
			background: #1e1e1e;
			color: #cccccc;
		}

		.test-section {
			background: #2d2d30;
			border: 1px solid #464647;
			border-radius: 8px;
			padding: 20px;
			margin: 20px 0;
		}

		.btn {
			background: #0e639c;
			color: white;
			border: none;
			padding: 10px 16px;
			border-radius: 4px;
			cursor: pointer;
			margin: 5px;
			font-size: 14px;
		}

		.btn:hover {
			background: #1177bb;
		}

		.btn.secondary {
			background: #5a5a5a;
		}

		.btn.secondary:hover {
			background: #6a6a6a;
		}

		.status {
			padding: 10px;
			border-radius: 4px;
			margin: 10px 0;
			display: none;
		}

		.status.success {
			background: #365c03;
			border: 1px solid #46760a;
			color: #cccccc;
		}

		.status.error {
			background: #5a1d1d;
			border: 1px solid #f85149;
			color: #cccccc;
		}

		.stats {
			background: #2d2d30;
			border: 1px solid #464647;
			border-radius: 4px;
			padding: 15px;
			margin: 10px 0;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
			gap: 15px;
		}

		.stat-item {
			text-align: center;
		}

		.stat-label {
			display: block;
			font-size: 12px;
			color: #999;
			margin-bottom: 5px;
		}

		.stat-value {
			display: block;
			font-size: 18px;
			font-weight: bold;
			color: #007acc;
		}

		textarea {
			width: 100%;
			height: 100px;
			background: #1e1e1e;
			border: 1px solid #464647;
			color: #cccccc;
			padding: 10px;
			border-radius: 4px;
			resize: vertical;
		}
	</style>
</head>

<body>
	<h1>ğŸ§ª PromptåŠŸèƒ½æµ‹è¯•é¡µé¢</h1>

	<div class="test-section">
		<h3>ğŸ“‹ å¤åˆ¶åŠŸèƒ½æµ‹è¯•</h3>
		<p>æµ‹è¯•ä¸åŒçš„å¤åˆ¶æ–¹æ¡ˆæ˜¯å¦éƒ½èƒ½æ­£å¸¸å·¥ä½œ</p>

		<textarea id="testPrompt" placeholder="åœ¨è¿™é‡Œè¾“å…¥è¦æµ‹è¯•çš„Promptå†…å®¹...">
è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•Promptï¼š
è¯·å¸®æˆ‘å†™ä¸€ä¸ªæ’åºç®—æ³•ï¼Œè¦æ±‚ï¼š
1. ä½¿ç”¨Pythonè¯­è¨€
2. å®ç°å¿«é€Ÿæ’åº
3. æ·»åŠ è¯¦ç»†æ³¨é‡Š
4. åŒ…å«æµ‹è¯•ç”¨ä¾‹

å¸Œæœ›ä»£ç ç®€æ´æ˜“æ‡‚ï¼Œæ€§èƒ½è‰¯å¥½ã€‚
        </textarea>

		<div style="margin-top: 10px;">
			<button class="btn" onclick="testCopyPrompt()">ğŸ“‹ æµ‹è¯•å¤åˆ¶åŠŸèƒ½</button>
			<button class="btn secondary" onclick="testFallbackCopy()">ğŸ“‹ æµ‹è¯•é™çº§å¤åˆ¶</button>
			<button class="btn secondary" onclick="testManualCopy()">ğŸ“‹ æµ‹è¯•æ‰‹åŠ¨å¤åˆ¶</button>
		</div>

		<div id="copyStatus" class="status"></div>
	</div>

	<div class="test-section">
		<h3>âœ… ä½¿ç”¨åŠŸèƒ½æµ‹è¯•</h3>
		<p>æµ‹è¯•ä½¿ç”¨Promptçš„å®Œæ•´æµç¨‹</p>

		<button class="btn" onclick="testUsePrompt()">âœ… æµ‹è¯•ä½¿ç”¨åŠŸèƒ½</button>
		<div id="useStatus" class="status"></div>
	</div>

	<div class="test-section">
		<h3>ğŸ“Š ç»Ÿè®¡æ•°æ®</h3>
		<div id="promptUsageStats" class="stats">
			<div class="stats-grid">
				<div class="stat-item">
					<span class="stat-label">ç”Ÿæˆæ¬¡æ•°</span>
					<span class="stat-value">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">ä½¿ç”¨æ¬¡æ•°</span>
					<span class="stat-value">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">å¤åˆ¶æ¬¡æ•°</span>
					<span class="stat-value">0</span>
				</div>
				<div class="stat-item">
					<span class="stat-label">ä½¿ç”¨å æ¯”</span>
					<span class="stat-value">0%</span>
				</div>
			</div>
		</div>
	</div>

	<script>
		// æ¨¡æ‹Ÿç»Ÿè®¡æ•°æ®
		let promptUsageStats = {
			generateCount: 0,
			copyCount: 0,
			useCount: 0,
			optimizeCount: 0
		};

		// æ¨¡æ‹Ÿvscodeæ¥å£
		const vscode = {
			postMessage: function (message) {
				console.log('ğŸ“¤ æ¨¡æ‹Ÿå‘é€æ¶ˆæ¯åˆ°VSCode:', message);
				showStatus('useStatus', 'âœ… æ¶ˆæ¯å·²å‘é€åˆ°VSCode (æ¨¡æ‹Ÿ)', 'success');
			}
		};

		// æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
		function showStatus(elementId, message, type) {
			const statusEl = document.getElementById(elementId);
			statusEl.textContent = message;
			statusEl.className = `status ${type}`;
			statusEl.style.display = 'block';

			setTimeout(() => {
				statusEl.style.display = 'none';
			}, 3000);
		}

		// å¤åˆ¶Promptåˆ°å‰ªè´´æ¿
		function copyPrompt(prompt) {
			console.log('ğŸ”„ æ­£åœ¨å¤åˆ¶Promptåˆ°å‰ªè´´æ¿...');

			// æ›´æ–°ç»Ÿè®¡
			promptUsageStats.copyCount++;

			// å°è¯•ä½¿ç”¨ç°ä»£APIå¤åˆ¶
			if (navigator.clipboard && window.isSecureContext) {
				navigator.clipboard.writeText(prompt).then(() => {
					console.log('âœ… Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
					showStatus('copyStatus', 'ğŸ“‹ Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
					// å‘é€ç»Ÿè®¡æ•°æ®
					sendUsageStats('copy');
				}).catch(err => {
					console.error('âŒ å¤åˆ¶å¤±è´¥:', err);
					fallbackCopy(prompt);
				});
			} else {
				// é™çº§æ–¹æ¡ˆ
				fallbackCopy(prompt);
			}
		}

		// é™çº§å¤åˆ¶æ–¹æ¡ˆ
		function fallbackCopy(prompt) {
			try {
				// åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
				const textArea = document.createElement('textarea');
				textArea.value = prompt;
				textArea.style.position = 'fixed';
				textArea.style.left = '-999999px';
				textArea.style.top = '-999999px';
				document.body.appendChild(textArea);
				textArea.focus();
				textArea.select();

				const successful = document.execCommand('copy');
				document.body.removeChild(textArea);

				if (successful) {
					console.log('âœ… Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆé™çº§æ–¹æ¡ˆï¼‰');
					showStatus('copyStatus', 'ğŸ“‹ Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆé™çº§æ–¹æ¡ˆï¼‰', 'success');
					sendUsageStats('copy');
				} else {
					throw new Error('execCommand failed');
				}
			} catch (err) {
				console.error('âŒ é™çº§å¤åˆ¶ä¹Ÿå¤±è´¥:', err);
				// æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶æç¤º
				showManualCopyDialog(prompt);
			}
		}

		// æ˜¾ç¤ºæ‰‹åŠ¨å¤åˆ¶å¯¹è¯æ¡†
		function showManualCopyDialog(prompt) {
			const modal = document.createElement('div');
			modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

			const dialog = document.createElement('div');
			dialog.style.cssText = `
                background: #2d2d30;
                border: 1px solid #464647;
                border-radius: 8px;
                padding: 20px;
                max-width: 500px;
                width: 90%;
                max-height: 400px;
            `;

			dialog.innerHTML = `
                <h3 style="margin-top: 0; color: #cccccc;">æ‰‹åŠ¨å¤åˆ¶ Prompt</h3>
                <p style="color: #999;">è¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š</p>
                <textarea readonly style="
                    width: 100%;
                    height: 200px;
                    border: 1px solid #464647;
                    background: #1e1e1e;
                    color: #cccccc;
                    padding: 10px;
                    border-radius: 4px;
                    resize: vertical;
                ">${prompt}</textarea>
                <div style="text-align: right; margin-top: 15px;">
                    <button id="copyDialogClose" class="btn secondary">å…³é—­</button>
                </div>
            `;

			modal.appendChild(dialog);
			document.body.appendChild(modal);

			// è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬
			const textarea = dialog.querySelector('textarea');
			setTimeout(() => {
				textarea.select();
				textarea.focus();
			}, 100);

			// å…³é—­æŒ‰é’®äº‹ä»¶
			dialog.querySelector('#copyDialogClose').addEventListener('click', () => {
				document.body.removeChild(modal);
			});

			// ç‚¹å‡»èƒŒæ™¯å…³é—­
			modal.addEventListener('click', (e) => {
				if (e.target === modal) {
					document.body.removeChild(modal);
				}
			});
		}

		// ä½¿ç”¨ç”Ÿæˆçš„Prompt
		function usePrompt(prompt) {
			console.log('ğŸš€ ä½¿ç”¨ç”Ÿæˆçš„Prompt...');

			// æ›´æ–°ç»Ÿè®¡
			promptUsageStats.useCount++;

			// é»˜è®¤å…ˆå¤åˆ¶å†…å®¹
			copyPrompt(prompt);

			// å‘é€ä½¿ç”¨ç»Ÿè®¡
			sendUsageStats('use');

			// æ˜¾ç¤ºä½¿ç”¨æç¤º
			showStatus('useStatus', 'âœ… Promptå·²å¤åˆ¶ï¼Œæ­£åœ¨è·³è½¬åˆ°é¢˜ç›®é¡µé¢...', 'success');

			console.log('ğŸ“ æ¨¡æ‹Ÿè·³è½¬åˆ°é¢˜ç›®é¡µé¢å¹¶è‡ªåŠ¨å¡«å…¥Prompt');
		}

		// å‘é€ä½¿ç”¨ç»Ÿè®¡æ•°æ®
		function sendUsageStats(action) {
			try {
				// å‘é€ç»Ÿè®¡æ•°æ®åˆ°åç«¯
				vscode.postMessage({
					command: 'recordPromptUsage',
					action: action,
					stats: promptUsageStats,
					timestamp: new Date().toISOString()
				});
				console.log(`ğŸ“Š ç»Ÿè®¡æ•°æ®å·²å‘é€: ${action}`, promptUsageStats);
				// æ›´æ–°æ˜¾ç¤º
				displayUsageStatistics();
			} catch (error) {
				console.error('âŒ å‘é€ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
			}
		}

		// è·å–ä½¿ç”¨ç»Ÿè®¡å æ¯”
		function getUsageRatio() {
			const total = promptUsageStats.generateCount + promptUsageStats.optimizeCount;
			const useTotal = promptUsageStats.useCount;
			const copyTotal = promptUsageStats.copyCount;

			if (total === 0) return { useRatio: 0, copyRatio: 0, totalGenerated: 0, totalUsed: useTotal, totalCopied: copyTotal };

			return {
				useRatio: Math.round((useTotal / total) * 100),
				copyRatio: Math.round((copyTotal / total) * 100),
				totalGenerated: total,
				totalUsed: useTotal,
				totalCopied: copyTotal
			};
		}

		// æ˜¾ç¤ºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯
		function displayUsageStatistics() {
			const ratio = getUsageRatio();
			console.log('ğŸ“Š å½“å‰ä½¿ç”¨ç»Ÿè®¡:', {
				ç”Ÿæˆæ¬¡æ•°: ratio.totalGenerated,
				ä½¿ç”¨æ¬¡æ•°: ratio.totalUsed,
				å¤åˆ¶æ¬¡æ•°: ratio.totalCopied,
				ä½¿ç”¨å æ¯”: ratio.useRatio + '%',
				å¤åˆ¶å æ¯”: ratio.copyRatio + '%'
			});

			// æ›´æ–°ç»Ÿè®¡æ˜¾ç¤ºå…ƒç´ 
			const statsElement = document.getElementById('promptUsageStats');
			if (statsElement) {
				statsElement.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">ç”Ÿæˆæ¬¡æ•°</span>
                            <span class="stat-value">${ratio.totalGenerated}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ä½¿ç”¨æ¬¡æ•°</span>
                            <span class="stat-value">${ratio.totalUsed}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å¤åˆ¶æ¬¡æ•°</span>
                            <span class="stat-value">${ratio.totalCopied}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ä½¿ç”¨å æ¯”</span>
                            <span class="stat-value">${ratio.useRatio}%</span>
                        </div>
                    </div>
                `;
			}
		}

		// æµ‹è¯•å‡½æ•°
		function testCopyPrompt() {
			const prompt = document.getElementById('testPrompt').value;
			if (!prompt.trim()) {
				showStatus('copyStatus', 'âŒ è¯·å…ˆè¾“å…¥æµ‹è¯•å†…å®¹', 'error');
				return;
			}
			copyPrompt(prompt);
		}

		function testFallbackCopy() {
			const prompt = document.getElementById('testPrompt').value;
			if (!prompt.trim()) {
				showStatus('copyStatus', 'âŒ è¯·å…ˆè¾“å…¥æµ‹è¯•å†…å®¹', 'error');
				return;
			}
			fallbackCopy(prompt);
		}

		function testManualCopy() {
			const prompt = document.getElementById('testPrompt').value;
			if (!prompt.trim()) {
				showStatus('copyStatus', 'âŒ è¯·å…ˆè¾“å…¥æµ‹è¯•å†…å®¹', 'error');
				return;
			}
			showManualCopyDialog(prompt);
		}

		function testUsePrompt() {
			const prompt = document.getElementById('testPrompt').value;
			if (!prompt.trim()) {
				showStatus('useStatus', 'âŒ è¯·å…ˆè¾“å…¥æµ‹è¯•å†…å®¹', 'error');
				return;
			}
			usePrompt(prompt);
		}

		// æ¨¡æ‹Ÿç”ŸæˆæŒ‰é’®ç‚¹å‡»ï¼Œå¢åŠ ç”Ÿæˆç»Ÿè®¡
		function simulateGenerate() {
			promptUsageStats.generateCount++;
			sendUsageStats('generate');
		}

		// é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹ç»Ÿè®¡
		document.addEventListener('DOMContentLoaded', function () {
			displayUsageStatistics();

			// æ·»åŠ ä¸€äº›æ¨¡æ‹ŸæŒ‰é’®
			const controlSection = document.createElement('div');
			controlSection.className = 'test-section';
			controlSection.innerHTML = `
                <h3>ğŸ® æ¨¡æ‹Ÿæ“ä½œ</h3>
                <p>æ¨¡æ‹Ÿç”Ÿæˆå’Œä¼˜åŒ–æ“ä½œæ¥æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½</p>
                <button class="btn secondary" onclick="simulateGenerate()">ğŸ“ æ¨¡æ‹Ÿç”ŸæˆPrompt</button>
                <button class="btn secondary" onclick="promptUsageStats.optimizeCount++; sendUsageStats('optimize');">ğŸ”§ æ¨¡æ‹Ÿä¼˜åŒ–Prompt</button>
                <button class="btn secondary" onclick="promptUsageStats = {generateCount: 0, copyCount: 0, useCount: 0, optimizeCount: 0}; displayUsageStatistics();">ğŸ”„ é‡ç½®ç»Ÿè®¡</button>
            `;
			document.body.appendChild(controlSection);
		});
	</script>
</body>

</html>